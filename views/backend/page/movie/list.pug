extends ./../../components/layout

block content
  .container
    header
      h1.text-center  电影管理列表
    table.table
      thead
        tr
          th 电影名称
          th 导演
          th 国家
          th 上映年份
          th 录入时间
          th.text-center 查看
          th.text-center 更新
          th.text-center 删除
      tbody.table-striped
        each item in movies
          - _id = item['_id']
          - trClass = 'item-' + item['_id']
          - lookItem = "/movie/" + item['_id']
          - updateItem = "/movie/update/" + item['_id']
          tr(class=trClass)
            td #{item.title}
            td #{item.doctor}
            td #{item.country}
            td #{item.year}
            td #{moment(item.meta.updateAt).format('YYYY-DD-MM')}
            td.text-center
              a(href=lookItem) 查看
            td.text-center
              a(href=updateItem) 编辑
            td.text-center
              button(class="btn btn-danger remove",data-id=_id) 删除

  script.
    $(function(){
      $('.table-striped .remove').click(function(e){
          var target = $(e.target)
          var id = target.data('id')
          var tr = $('.item-' + id)

          $.ajax({
              type:'delete',
              url:'/movie/list',
              data:{
                  id: id
              }
          })
          .done(function(response){
              console.log(response)
              if (response.statuscode == 200){
                  if(tr.length >0){
                      tr.remove()
                  }
              }
          })
      })
    })
